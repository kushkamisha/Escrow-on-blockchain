<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />

    <title>The house</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Custom styles for this template -->
    <link href="css/shop.css" rel="stylesheet" />
  </head>

  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
      <div class="container">
        <a class="navbar-brand" href="/">Escrow on Blockchain</a>
        <button
          class="navbar-toggler"
          type="button"
          data-toggle="collapse"
          data-target="#navbarResponsive"
          aria-controls="navbarResponsive"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item active">
              <a class="nav-link" href="#"
                >Home
                <span class="sr-only">(current)</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Services</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Contact</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Page Content -->
    <div class="container">
      <div class="row">
        <div class="col-lg-3">
          <h1 class="my-4">Crypto Houses</h1>
          <div class="list-group">
            <a href="#" class="list-group-item">Big houses</a>
            <a href="#" class="list-group-item">Medium houses</a>
            <a href="#" class="list-group-item">Small houses</a>
          </div>
        </div>
        <!-- /.col-lg-3 -->

        <div class="col-lg-9">
          <div class="card mt-4">
            <img class="card-img-top img-fluid" id="house-image" src="#" alt="" />
            <div class="card-body">
              <h3 class="card-title" id="house-name"></h3>
              <h4 id="house-price"></h4>
              <h5 class="text-muted" id="house-address"></h5>
              <p class="card-text" id="house-description"></p>
              <span class="text-warning">&#9733; &#9733; &#9733; &#9733; &#9734;</span>
              4.0 stars
            </div>
          </div>
          <!-- /.card -->

          <div class="card card-outline-secondary my-4">
            <div class="card-header">Product Details</div>
            <div class="card-body">
              <!-- House details -->
              <div class="row" id="house-details"></div>
              <!-- /.details-->
              <hr />
              <a href="#" class="btn btn-success">Buy This House</a>
            </div>
          </div>
          <!-- /.card -->
        </div>
        <!-- /.col-lg-9 -->
      </div>
    </div>
    <!-- /.container -->

    <!-- Footer -->
    <footer class="py-5 bg-dark">
      <div class="container">
        <p class="m-0 text-center text-white">Copyright &copy; Crypto houses 2021</p>
      </div>
      <!-- /.container -->
    </footer>

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script src="javascript/abi.js"></script>
    <script src="javascript/houseInfo.js"></script>
    <script src="javascript/main.js"></script>
    <script>
      const capitalizeFirstLetter = (str) => str.charAt(0).toUpperCase() + str.slice(1)

      window.onload = async () => {
        const escrowAddr = document.location.href.split('#')[1]
        const house = await getAHouse(escrowAddr)
        console.log({ house })

        const houseId = house.houseId
        const details = {
          seller: house.seller,
          intermediate: house.intermediate,
          houseId,
          price: house.price,
        }

        $('title').text(name)
        $('#house-image').attr('src', `img/house-${houseId}.jpg`)
        $('#house-name').text(window.houseInfo[houseId].title)
        $('#house-price').text(`${house.price} ETH`)
        $('#house-description').text(window.houseInfo[houseId].description)
        $('#house-address').text(house.houseAddress)

        for (const [name, value] of Object.entries(details)) {
          const width = `${value}`.match(/0x/g) ? 12 : 6

          $('#house-details').append(`
          <div class="p-3 col-sm-${width}">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">${capitalizeFirstLetter(name)}</h5>
                <p class="card-text">${value}</p>
              </div>
            </div>
          </div>
        `)
        }
      }
    </script>
  </body>
</html>
